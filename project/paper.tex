\documentclass[12pt]{article}

% This first part of the file is called the PREAMBLE. It includes
% customizations and command definitions. The preamble is everything
% between \documentclass and \begin{document}.

\usepackage[margin=1in]{geometry}  % set the margins to 1in on all sides
\usepackage{graphicx}              % to include figures
\usepackage{amsmath,bm}            % great math stuff
\usepackage{amsfonts}              % for blackboard bold, etc
\usepackage{amsthm}                % better theorem environments
\usepackage{listings}
\usepackage{hyperref}
\usepackage{tikz}
\usepackage[linesnumbered,ruled,vlined,algosection]{algorithm2e}
\usepackage{parskip} 			   % no paragraph indentation

\usetikzlibrary{arrows,automata,decorations.pathreplacing,math}

\input{include/Walgo.tex}

% various tikz defs
\makeatletter
\newcommand{\gettikzxy}[3]{%
  \tikz@scan@one@point\pgfutil@firstofone#1\relax
  \edef#2{\the\pgf@x}%
  \edef#3{\the\pgf@y}%
}
\makeatother

% various theorems, numbered by section

\newtheorem{thm}{Theorem}[section]
\newtheorem{lem}[thm]{Lemma}
\newtheorem{prop}[thm]{Proposition}
\newtheorem{cor}[thm]{Corollary}
\newtheorem{conj}[thm]{Conjecture}
\newtheorem{defi}[thm]{Definition}

\DeclareMathOperator{\id}{id}

\newcommand{\bd}[1]{\mathbf{#1}}  % for bolding symbols
\newcommand{\RR}{\mathbb{R}}      % for Real numbers
\newcommand{\ZZ}{\mathbb{Z}}      % for Integers
\newcommand{\col}[1]{\left[\begin{matrix} #1 \end{matrix} \right]}
\newcommand{\comb}[2]{\binom{#1^2 + #2^2}{#1+#2}}

\lstset{ % General setup for the package
    language={[LaTeX]TeX},
    basicstyle=\footnotesize\sffamily,
    tabsize=4,
    columns=fixed,
    keepspaces,
    commentstyle=\color{red},
    keywordstyle=\color{blue},
    xleftmargin=.1\textwidth,
    xrightmargin=.1\textwidth
}

\begin{document}

\nocite{*}


\title{Topics in Algorithms}

\author{Viktor Hansen \& Mehdi Nadif}

\maketitle

\begin{abstract}
  This comprises our project covering Approximation Distance Oracles with Improved Query Time for the Topics in Algorithms course offered at The Department of Computer Science, Uni. Copenhagen.
\end{abstract}

\pagebreak

\section{Overview}
% Assumptions about the reader

\begin{figure}
\centering
\begin{tikzpicture}
\filldraw (0,0) circle (2pt) node[align=left,   below] {$u$};
\filldraw (10,0) circle (2pt) node[align=right,  below] {$v$};
\filldraw[fill=gray] (4,3) circle (2pt) node[align=left, above] {$p_j(u)$};
\filldraw[fill=gray] (8,3.5) circle (2pt) node[align=left, above] {$p_{j+1}(v)$};
\coordinate (u) at (0,0) ;
\coordinate (v) at (10,0);
\coordinate (pu) at (4,3);
\coordinate (pv) at (8, 3.5);
\draw[dashed] (v) circle [radius=4];
\draw (u) -- (pu) node[pos=0.5, above, sloped] {$d_G(u,p_j(u))$};
\draw (u) -- (v) node[pos=0.5, below, sloped] {$d_G(u,v))$};
\draw (v) -- (pv);
\end{tikzpicture}
\caption{Lorem Ipsumthing}
\end{figure}

\begin{figure}
\centering
\begin{tikzpicture}
\tikzmath{
  \a = 3;
  \b = 2;
  \i0 = 0;
  \i1 = 0*\a+\b;
  \i2 = 0.75*\a+\b;
  \i3 = 1.7*\a+\b;
  \i4 = 2.5*\a+\b;
  \i5 = 3.25*\a+\b;
  \i6 = 4*\a+\b;
  \s0 = 0;
  \s1 = \s0 + \i1;
  \s2 = \s1 + \i2;
  \s3 = \s2 + \i3;
  \s4 = \s3 + \i4;
  \s5 = \s4 + \i5;
  \s6 = \s5 + \i6;
}

%\draw[-latex] (0,0) -- (4.5*\a+\b,0);
\draw[-] (0,0) -- (\i1*0.2,0);
\draw[dashed] (\i1*0.2,0) -- (\i1-\i1*0.2,0);
\draw[-] (\i1-\i1*0.2,0) -- (\i1,0);

\draw[-] (\i1,0) -- (\i1+\i2*0.2-\i1*0.2,0);
\draw[dashed] (\i1+\i2*0.2-\i1*0.2,0) -- (\i2-\i2*0.2+\i1*0.2,0);
\draw[-] (\i2-\i2*0.2+\i1*0.2,0) -- (\i2,0);

\draw[-,thick,red] (\i2,0) -- (\i3,0);

\draw[-] (\i3,0) -- (\i3+\i4*0.2-\i3*0.2,0);
\draw[dashed] (\i3+\i4*0.2-\i3*0.2,0) -- (\i4-\i4*0.2+\i3*0.2,0);
\draw[-] (\i4-\i4*0.2+\i3*0.2,0) -- (\i4,0);

\draw[-] (\i4,0) -- (\i5,0);

\draw[-] (\i5,0) -- (\i5+\i6*0.2-\i5*0.2,0);
\draw[dashed] (\i5+\i6*0.2-\i5*0.2,0) -- (\i6-\i6*0.2+\i5*0.2,0);
\draw[-] (\i6-\i6*0.2+\i5*0.2,0) -- (\i6,0);

\draw[-latex] (\i6,0) -- (\i6+1,0);

% 0
\draw[shift={(0,0)},color=black] (0pt,3pt) -- (0pt,-3pt);
\draw[shift={(0,0)},color=black] (0pt,0pt) -- (0pt,-3pt) node[below] 
{$0$};


% p_i_1
\draw[shift={(\i1,0)},color=black] (0pt,3pt) -- (0pt,-3pt);
\draw[shift={(\i1,0)},color=black] (0pt,0pt) -- (0pt,-3pt) node[below] 
{$d_G(p_{i_1}(u))$};

% p_j
\draw[shift={(\i2,0)},color=black] (0pt,3pt) -- (0pt,-3pt);
\draw[shift={(\i2,0)},color=black] (0pt,0pt) -- (0pt,-3pt) node[below] 
{$d_G(p_j(u))$};

% p_j_p2
\draw[shift={(\i3,0)},color=black] (0pt,3pt) -- (0pt,-3pt);
\draw[shift={(\i3,0)},color=black] (0pt,0pt) -- (0pt,-3pt) node[below] 
{$d_G(p_{j+2}(u))$};

% p_i
\draw[shift={(\i4,0)},color=black] (0pt,3pt) -- (0pt,-3pt);
\draw[shift={(\i4,0)},color=black] (0pt,0pt) -- (0pt,-3pt) node[below] 
{$d_G(p_{i-2}(u))$};

% p_i_p2
\draw[shift={(\i5,0)},color=black] (0pt,3pt) -- (0pt,-3pt);
\draw[shift={(\i5,0)},color=black] (0pt,0pt) -- (0pt,-3pt) node[below] 
{$d_G(p_{i}(u))$};

% p_i_2
\draw[shift={(\i6,0)},color=black] (0pt,3pt) -- (0pt,-3pt);
\draw[shift={(\i6,0)},color=black] (0pt,0pt) -- (0pt,-3pt) node[below] 
{$d_G(p_{i_2}(u))$};

% d_G(u,p_{1_i}(u))
\draw[decorate,decoration={brace,amplitude=10pt,raise=4pt},yshift=0pt]
(0,1.2) -- (\i1,1.2) node [black,midway,xshift=0cm,yshift=23pt] {\footnotesize
$d_G(u,p_{i_1}(u))$};

% \delta_j(u)
\draw[decorate,decoration={brace,amplitude=10pt,mirror,raise=4pt},yshift=0pt]
(\i3,0.075) -- (\i2,0.075) node [black,midway,xshift=0cm,yshift=23pt] {\footnotesize
$\delta_j(u)$};

% \sum
\draw[decorate,decoration={brace,amplitude=10pt,mirror,raise=4pt},yshift=0pt]
(\i5,1.2) -- (\i1,1.2) node [black,midway,xshift=0cm,yshift=23pt] {\footnotesize
$\sum_{j' \in \mathcal{I}'}\delta_{j'}(u)$};

\draw[dashed] (0,0) -- (0,1.2);
\draw[dashed] (\i1,0) -- (\i1,1.2);
\draw[dashed] (\i5,0) -- (\i5,1.2);

\end{tikzpicture}
\caption{Lorem Ipsumthing}
\end{figure}
% Reference til Mikkel/Zwick paper - hans query time og 'vores' forbedrede query time - forbedring af konstruktion. Forbedring i querytime, uden at det påvirker space/konstruktionstid.

% Motivation

% Girth Conjecture?

Given an undirected, positively weighted graph $G$ with $m$ edges, $n$ vertices and given $k \in \mathbb{Z}$, $k \geq 2$, we show that a $2k-1$ approximate distance oracle for $G$ of size $O(kn^{1+1/k})$ and with $O(\lg k)$ query time can be constructed in $O( \min \left\{ kmn^{1/k}, \sqrt{k}m+kn^{1+c/\sqrt{k}} \right\})$ time for some constant $c$.
% Definitioner
\begin{itemize}
\item $d_{G}(u,v)$: the shortest path distance between $u$ and $v$.
\item $A_i = \left\{ a \in A_{i-1} \; | \; a \text{ sampled with prob. } n^{-1/k} \text{ uniformly, i.i.d.} \right\}$
\item $V = A_0 \supseteq A_1 \supseteq \hdots \supseteq A_k = \emptyset$
\item $p_i(u) = \min_{v \in A_i} \left\{ d_{G}(u,v) \right\}$
\item $B_u=\bigcup_{i=0}^{k-1}\left\{ v \in A_i - A_{i+1} \; | \; d_{G}(u,v) < d_{G}(u, p_{i+1}(u)) \right\}$
\item $d_G(u,p_k(u))=\infty$
\end{itemize}

\begin{lem}
Let $u,v \in V$ be distinct vertices $0 \leq i < k-1$. If $p_i(v) \not\in B_{u}$ then $d_G(u, p_{i+1}(u)) \leq d_G(u, p_i(v))$. Furthermore $A_{k-1} \subset B_u$ and $p_{k-1}(v) \in B_u$. \label{lem:onedeltaperiteration}
\end{lem}

\section{Oracle with $O(\lg k)$ query time}
\begin{Walgo}[ht]{20pt}
  \DontPrintSemicolon
  \SetKwRepeat{Do}{do}{while}
  \SetKwInOut{Input}{Input}
  \SetKwInOut{Output}{Output}
  \Indm
    \Indp
    \BlankLine
    $w \leftarrow p_i(u); j \leftarrow i$
    
    \While{$w \not\in B_v$}{
      $j \leftarrow j + 1$
      
      $(u,v) \leftarrow (v,u)$
      
      $w \leftarrow p_j(u)$
    }
    \Return{$d_G(w,u) + d_G(w,v)$}
    
    \caption{$dist_k(u,v,i)$}
    \label{alg:0.1}
\end{Walgo}

\begin{defi}
For vertices $u,v \in V$ an index $j \in \mathcal{I}$ is $(u,v)$-terminal if
\begin{enumerate}
\item $j = k-1$ or
\item $j < k-1$ is even and $p_j(u) \in B_v$ or $p_{j+1}(v) \in B_u$ 
\end{enumerate}
We note that $j$ attains a $(u,v)$ terminal index, the algorithm terminates in the current or next iteration.
\end{defi}

\begin{defi}
A subsequence $\mathcal{I'}=i_1, \hdots, i_2$ of $\mathcal{I}$ is $(u,v)$-feasible if
\begin{enumerate}
\item $i_1$ is even and
\item $d_{G}(p_{i_1}(u),u) \leq i_1 \cdot d_G(u,v)$ and
\item $i_2$ is $(u,v)$-terminal
\end{enumerate}
\end{defi}

\begin{lem}
Let $i_1, \hdots, i_2$ be a $(u,v)$-feasible subsequence. Then $dist_k(u,v,i_1)$ gives a $2k-1$ approximation of $d_G(u,v)$ in time $O(i_2-i_1)$.
\paragraph{Proof} By assumption $i_2$ is $(u,v)$-terminal. Therefore, $p_{i_2}(u) \in B_v$ or $p_{i_2 + 1}(v) \in B_u$. Thus $dist_k(u,v,i_1)$ terminates when $j=O(i_2)$ in time $O(i_2-i_1)$.

Furthermore $d_{G}(p_{i_1}(u),u) \leq i_1 \cdot d_G(u,v)$. When $p_j(u) = w \not\in B_v$
we have $d_G(v,p_{j+1}(v)) \leq d_G(v,p_{j}(u)) \leq d_G(v,u) + d_G(u,p_j(u))$ by Lemma \ref{lem:onedeltaperiteration} and the triangle inequality. Hence each iteration of $dist_k(u,v,i)$ increases $d_G(u,w)$ by at most $d_G(u,v)$. At termination we have
\begin{align*}
d_G(u,w) + d_G(w,v) &\leq 2d_G(u,w) + d_G(u,v) \\
&\leq 2(i_1 \cdot d_G(u,v) + (i_2 - i_1)d_G(u,v)) + d_G(u,v) \\
&\leq 2 \cdot i_2 \cdot d_G(u,v) + d_G(u,v) \\
&\leq (2 \cdot i_2 + 1)d_G(u,v) \\
&\leq (2 (k-1) + 1)d_G(u,v) \\
&\leq (2k-1) d_G(u,v)
\end{align*}
\end{lem}
% Inkluder illustration - forklarende tekst "By lemma 2.1 and the triangle inequality"

% Lemma 3.2 her - Hele sekvensen, svarende til at køre Thorup-Zwick i=1...k

% Lemma 3.3 her - "skip hver anden" - gør analysen symmetrisk - lav illustration (projicer punkter ned på reelle akse og indtegn afstande). Forklar bevis.

\begin{lem}
Let $i_1, \hdots, i_2$ be a $(u,v)$-feasible subsequence and let $i$ be even, $i_1+2 \leq i \leq i_2-2$. Let $j$ be an even index in subsequence $i_1, \hdots ,i-2$ that maximizes $\delta_j(u)$. If $p_j(u) \not\in B_v$ and $p_j+1(v) \not\in B_u$ then $i, \hdots , i_2$ is $(u,v)$-feasible. Otherwise, $i_1, \hdots , j$ is $(u,v)$-feasible.

\paragraph{Proof} If $p_j(u) \in B_v$ or $p_j+1(v) \in B_u$, then $j$ is $(u,v)$-feasible, and so is $i_1, \hdots, j$. Assume that $p_j(u) \not\in B_v$ and $p_j+1(v) \not\in B_u$. Then, by Lemma \ref{lem:lemma1}, $d_G(v,p_{j+1}(v)) \leq d_G(v,p_{j}(u))$ and $d_G(u,p_{j+2}(u)) \leq d_G(u,p_{j+1(v)})$. Applying the triangle inequality twice, we get 
\begin{align*}
d_G(u,p_{j+2}(u) &\leq d_G(u,p_{j+1}(v)) \\
&\leq d_G(u,v) + d_G(v, p_{j+1}(v)) \\
&\leq d_G(u,v) + d_G(v, p_{j}(u)) \\
&\leq 2d_G(u,v) + d_G(u, p_{j}(u))
\end{align*}
so $\delta_j(u) = d_G(u,p_{j+2}(u)) - d_G(u,p_j(u)) \leq 2d_G(u,v)$. Let $\mathcal{I}'$ be the set of even indices $i_1, i_1+2, i_1+4, \hdots, i-2$. Since $i_1, \hdots, i_2$ is $(u,v)$-feasible, $d_G(u,p_{i_1}(u)) \leq i_1 \cdot d_G(u,v)$. By the choice of $j$,
\begin{align*}
d_G(u,p_{i}(u)) &= d_G(u,p_{i_1}(u)) + \sum_{j' \in \mathcal{I'}}\delta_{j'}(u) \\
&\leq d_G(u,p_{i_1}(u)) + \left| \mathcal{I'} \right| \max_{j' \in \mathcal{I'}}\delta_{j'}(u) \\
&= d_G(u,p_{i_1}(u)) + \frac{i-i_1}{2} \delta_{j}(u) \\
&\leq i_1 \cdot d_G(u,v) + (i-i_1)d_G(u,v) \\
&= i \cdot d_G(u,v)
\end{align*}
Hence, since $i_1, \hdots, i_2$ is $(u,v)$-feasible, so is $i, \hdots, i_2$.
\end{lem}


\end{document}
